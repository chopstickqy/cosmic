{"title":"深入了解 qiankun 微前端架构","uid":"1624086166b29c0173181762fde3aaec","slug":"2021-07-26","date":"2021-07-25T16:00:00.000Z","updated":"2025-02-15T17:52:03.176Z","comments":true,"path":"api/articles/2021-07-26.json","keywords":null,"cover":null,"content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>随着前端应用的复杂度不断提升，传统的单体应用架构逐渐暴露出维护困难、技术栈升级困难等问题。为了解决这些挑战，微前端架构应运而生。qiankun 作为一款基于 single-spa 的微前端实现库，提供了高效、灵活的解决方案，帮助开发者构建可维护、可扩展的前端系统。</p>\n<h2 id=\"什么是微前端？\"><a href=\"#什么是微前端？\" class=\"headerlink\" title=\"什么是微前端？\"></a>什么是微前端？</h2><p>微前端是一种将大型前端应用拆分成多个小型、独立、自治的子应用的架构模式。每个子应用可以使用不同的技术栈，独立开发、独立部署，最终通过主应用进行统一管理和展示。微前端的核心思想是“拆”和“合”，即将复杂的应用拆解成多个小模块，再通过主应用将其组合成一个完整的系统。</p>\n<h2 id=\"Qiankun-的优势\"><a href=\"#Qiankun-的优势\" class=\"headerlink\" title=\"Qiankun 的优势\"></a>Qiankun 的优势</h2><p>Qiankun 作为微前端的实现库，具有以下优势：</p>\n<ul>\n<li><strong>技术栈无关</strong>：主应用和子应用可以使用不同的技术栈，互不干扰。</li>\n<li><strong>独立开发与部署</strong>：每个子应用可以独立开发、独立部署，提升开发效率。</li>\n<li><strong>增量升级</strong>：可以逐步将老旧系统迁移到微前端架构，实现平滑过渡。</li>\n<li><strong>运行时隔离</strong>：子应用之间相互隔离，避免相互影响。</li>\n</ul>\n<h2 id=\"Qiankun-的工作原理\"><a href=\"#Qiankun-的工作原理\" class=\"headerlink\" title=\"Qiankun 的工作原理\"></a>Qiankun 的工作原理</h2><p>Qiankun 通过以下方式实现微前端架构：</p>\n<ol>\n<li><strong>主应用注册子应用</strong>：主应用通过 Qiankun 提供的 API 注册各个子应用，指定子应用的加载方式、路由规则等。</li>\n<li><strong>子应用加载</strong>：当路由匹配到某个子应用时，Qiankun 会加载对应的子应用，并将其挂载到指定的 DOM 节点上。</li>\n<li><strong>生命周期管理</strong>：Qiankun 为每个子应用提供了生命周期钩子函数，如 <code>bootstrap</code>、<code>mount</code>、<code>unmount</code>，开发者可以在这些钩子中编写相应的逻辑。</li>\n</ol>\n<h2 id=\"实践案例\"><a href=\"#实践案例\" class=\"headerlink\" title=\"实践案例\"></a>实践案例</h2><p>为了更好地理解 qiankun 的使用，以下是一个简单的示例，展示了如何使用 qiankun 实现微前端架构。</p>\n<h3 id=\"架构示意图\"><a href=\"#架构示意图\" class=\"headerlink\" title=\"架构示意图\"></a>架构示意图</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+-------------------+</span><br><span class=\"line\">|   主应用 (Angular)   |</span><br><span class=\"line\">|                   |</span><br><span class=\"line\">|  +-------------+  |</span><br><span class=\"line\">|  | 子应用 1    |  |</span><br><span class=\"line\">|  | (Angular)  |  |</span><br><span class=\"line\">|  +-------------+  |</span><br><span class=\"line\">|  +-------------+  |</span><br><span class=\"line\">|  | 子应用 2    |  |</span><br><span class=\"line\">|  | (Vue)      |  |</span><br><span class=\"line\">|  +-------------+  |</span><br><span class=\"line\">|  +-------------+  |</span><br><span class=\"line\">|  | 子应用 3    |  |</span><br><span class=\"line\">|  | (React)    |  |</span><br><span class=\"line\">|  +-------------+  |</span><br><span class=\"line\">+-------------------+</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"实现步骤\"><a href=\"#实现步骤\" class=\"headerlink\" title=\"实现步骤\"></a>实现步骤</h2><h3 id=\"1-创建主应用-Angular\"><a href=\"#1-创建主应用-Angular\" class=\"headerlink\" title=\"1. 创建主应用 (Angular)\"></a>1. 创建主应用 (Angular)</h3><p>首先，在 Angular 项目中安装 qiankun</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install qiankun</span><br></pre></td></tr></table></figure>\n\n<p>然后，在主应用中设置 qiankun 来加载子应用：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Component</span>, <span class=\"title class_\">OnInit</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; registerMicroApps, setDefaultMountApp, start &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;qiankun&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">@<span class=\"title class_\">Component</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">selector</span>: <span class=\"string\">&#x27;#parent-angular app-root&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">templateUrl</span>: <span class=\"string\">&#x27;./app.component.html&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">styleUrls</span>: [<span class=\"string\">&#x27;./app.component.scss&#x27;</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AppComponent</span> implements <span class=\"title class_\">OnInit</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">ngOnInit</span>() : <span class=\"keyword\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"title function_\">registerMicroApps</span>();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">registerMicroApps</span>() : <span class=\"keyword\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">registerMicroApps</span>([</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">name</span>: <span class=\"string\">&#x27;child-react&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">entry</span>: <span class=\"string\">&#x27;//localhost:3000&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">container</span>: <span class=\"string\">&#x27;#subapp-viewer&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">activeRule</span>: <span class=\"function\"><span class=\"params\">location</span> =&gt;</span> location.<span class=\"property\">hash</span>.<span class=\"title function_\">startsWith</span>(<span class=\"string\">&#x27;#/sub-micro/child-react&#x27;</span>)</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">name</span>: <span class=\"string\">&#x27;child-vue&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">entry</span>: <span class=\"string\">&#x27;//localhost:8080&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">container</span>: <span class=\"string\">&#x27;#subapp-viewer&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">activeRule</span>: <span class=\"function\"><span class=\"params\">location</span> =&gt;</span> location.<span class=\"property\">hash</span>.<span class=\"title function_\">startsWith</span>(<span class=\"string\">&#x27;#/sub-micro/child-vue&#x27;</span>)</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">name</span>: <span class=\"string\">&#x27;child-angular&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">entry</span>: <span class=\"string\">&#x27;//localhost:4300&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">container</span>: <span class=\"string\">&#x27;#subapp-viewer&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">activeRule</span>: <span class=\"function\"><span class=\"params\">location</span> =&gt;</span> location.<span class=\"property\">hash</span>.<span class=\"title function_\">startsWith</span>(<span class=\"string\">&#x27;#/sub-micro/child-angular&#x27;</span>)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      <span class=\"attr\">beforeLoad</span>: [</span><br><span class=\"line\">        <span class=\"function\"><span class=\"params\">app</span> =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;[LifeCycle] before load %c%s&#x27;</span>, <span class=\"string\">&#x27;color: green;&#x27;</span>, app.<span class=\"property\">name</span>);</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"title class_\">Promise</span>.<span class=\"title function_\">resolve</span>();</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      ],</span><br><span class=\"line\">      <span class=\"attr\">beforeMount</span>: [</span><br><span class=\"line\">        <span class=\"function\"><span class=\"params\">app</span> =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;[LifeCycle] before mount %c%s&#x27;</span>, <span class=\"string\">&#x27;color: green;&#x27;</span>, app.<span class=\"property\">name</span>);</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"title class_\">Promise</span>.<span class=\"title function_\">resolve</span>();</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      ],</span><br><span class=\"line\">      <span class=\"attr\">afterUnmount</span>: [</span><br><span class=\"line\">        <span class=\"function\"><span class=\"params\">app</span> =&gt;</span> &#123;</span><br><span class=\"line\">          <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;[LifeCycle] after unmount %c%s&#x27;</span>, <span class=\"string\">&#x27;color: green;&#x27;</span>, app.<span class=\"property\">name</span>);</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"title class_\">Promise</span>.<span class=\"title function_\">resolve</span>();</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      ],</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在子项目路由根组件中调用<code>start</code>方法加载<code>qiankun</code></p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">AfterViewInit</span>, <span class=\"title class_\">Component</span>, <span class=\"title class_\">OnInit</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; registerMicroApps, start &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;qiankun&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Component</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">selector</span>: <span class=\"string\">&#x27;app-sub-micro&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">templateUrl</span>: <span class=\"string\">&#x27;./sub-micro.component.html&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">styleUrls</span>: [<span class=\"string\">&#x27;./sub-micro.component.scss&#x27;</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SubMicroComponent</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">OnInit</span>, <span class=\"title class_\">AfterViewInit</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\"></span>) &#123; &#125;</span><br><span class=\"line\">  <span class=\"title function_\">ngAfterViewInit</span>(): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">start</span>(</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"attr\">prefetch</span>: <span class=\"literal\">false</span> <span class=\"comment\">// 取消预加载</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">ngOnInit</span>(): <span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-创建子应用-Angular\"><a href=\"#2-创建子应用-Angular\" class=\"headerlink\" title=\"2. 创建子应用 (Angular)\"></a>2. 创建子应用 (Angular)</h3><p>使用 Angular 创建一个子应用，并确保它能够独立运行。确保在构建时，将子应用暴露为一个微前端应用，供主应用加载。<br>通过<code>window.__POWERED_BY_QIANKUN__</code>标识判断当前应用是否是通过 qiankun 加载的微前端子应用。如果该值为 true，说明当前应用是一个微前端子应用；如果为 false，说明应用是独立运行的</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"variable constant_\">APP_BASE_HREF</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/common&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">NgModule</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">RouterModule</span>, <span class=\"title class_\">Routes</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/router&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">routes</span>: <span class=\"title class_\">Routes</span> = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">path</span>: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">loadChildren</span>: <span class=\"function\">() =&gt;</span> <span class=\"keyword\">import</span>(<span class=\"string\">&#x27;./home/home.module&#x27;</span>).<span class=\"title function_\">then</span>(<span class=\"function\"><span class=\"params\">m</span> =&gt;</span> m.<span class=\"property\">HomeModule</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">path</span>: <span class=\"string\">&#x27;readme&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">loadChildren</span>: <span class=\"function\">() =&gt;</span> <span class=\"keyword\">import</span>(<span class=\"string\">&#x27;./readme/readme.module&#x27;</span>).<span class=\"title function_\">then</span>(<span class=\"function\"><span class=\"params\">m</span> =&gt;</span> m.<span class=\"property\">ReadmeModule</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NgModule</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">imports</span>: [<span class=\"title class_\">RouterModule</span>.<span class=\"title function_\">forRoot</span>(routes)],</span><br><span class=\"line\">  <span class=\"attr\">exports</span>: [<span class=\"title class_\">RouterModule</span>],</span><br><span class=\"line\">  <span class=\"comment\">// @ts-ignore</span></span><br><span class=\"line\">  <span class=\"attr\">providers</span>: [&#123;<span class=\"attr\">provide</span>: <span class=\"variable constant_\">APP_BASE_HREF</span>, <span class=\"attr\">useValue</span>: <span class=\"variable language_\">window</span>.<span class=\"property\">__POWERED_BY_QIANKUN__</span> ? <span class=\"string\">&#x27;/sub-micro/child-angular&#x27;</span> : <span class=\"string\">&#x27;/&#x27;</span>&#125;]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AppRoutingModule</span> &#123; &#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-创建子应用-Vue\"><a href=\"#3-创建子应用-Vue\" class=\"headerlink\" title=\"3. 创建子应用 (Vue)\"></a>3. 创建子应用 (Vue)</h3><p>使用 Vue 创建一个子应用，并确保它能够独立运行。确保在构建时，将子应用暴露为一个微前端应用，供主应用加载。<br>通过<code>window.__POWERED_BY_QIANKUN__</code>标识判断当前应用是否是通过 qiankun 加载的微前端子应用。如果该值为 true，说明当前应用是一个微前端子应用；如果为 false，说明应用是独立运行的</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Vue</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">VueRouter</span>, &#123; <span class=\"title class_\">RouteConfig</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue-router&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Home</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;../views/Home.vue&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">declare</span> <span class=\"keyword\">const</span> <span class=\"attr\">window</span>: <span class=\"built_in\">any</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">Vue</span>.<span class=\"title function_\">use</span>(<span class=\"title class_\">VueRouter</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">routes</span>: <span class=\"title class_\">RouteConfig</span>[] = [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">path</span>: <span class=\"string\">&#x27;/sub-micro/child-vue/&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;Home&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">component</span>: <span class=\"title class_\">Home</span>,</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">path</span>: <span class=\"string\">&#x27;/sub-micro/child-vue/about&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;About&#x27;</span>,</span><br><span class=\"line\">    <span class=\"comment\">// route level code-splitting</span></span><br><span class=\"line\">    <span class=\"comment\">// this generates a separate chunk (about.[hash].js) for this route</span></span><br><span class=\"line\">    <span class=\"comment\">// which is lazy-loaded when the route is visited.</span></span><br><span class=\"line\">    <span class=\"attr\">component</span>: <span class=\"function\">() =&gt;</span> <span class=\"keyword\">import</span>(<span class=\"comment\">/* webpackChunkName: &quot;about&quot; */</span> <span class=\"string\">&#x27;../views/About.vue&#x27;</span>),</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">];</span><br><span class=\"line\"><span class=\"keyword\">const</span> router = <span class=\"keyword\">new</span> <span class=\"title class_\">VueRouter</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">base</span>: <span class=\"variable language_\">window</span>.<span class=\"property\">__POWERED_BY_QIANKUN__</span> ? <span class=\"string\">&#x27;/sub-micro/child-vue&#x27;</span> : <span class=\"string\">&#x27;/sub-micro/child-vue&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;hash&#x27;</span>,</span><br><span class=\"line\">  routes,</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> router;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-创建子应用-React\"><a href=\"#4-创建子应用-React\" class=\"headerlink\" title=\"4. 创建子应用 (React)\"></a>4. 创建子应用 (React)</h3><p>使用 React 创建一个子应用，并确保它能够独立运行。确保在构建时，将子应用暴露为一个微前端应用，供主应用加载。<br>通过<code>window.__POWERED_BY_QIANKUN__</code>标识判断当前应用是否是通过 qiankun 加载的微前端子应用。如果该值为 true，说明当前应用是一个微前端子应用；如果为 false，说明应用是独立运行的</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;./public-path&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">React</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">ReactDOM</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react-dom&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">BrowserRouter</span>,<span class=\"title class_\">HashRouter</span>,<span class=\"title class_\">Route</span>,<span class=\"title class_\">Switch</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;react-router-dom&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;./index.css&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Home</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./home&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">Readme</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./readme/readme&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">render</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; container &#125; = props;</span><br><span class=\"line\">  <span class=\"title class_\">ReactDOM</span>.<span class=\"title function_\">render</span>(</span><br><span class=\"line\">    <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">React.StrictMode</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;<span class=\"name\">HashRouter</span> <span class=\"attr\">basename</span>=<span class=\"string\">&#123;window.__POWERED_BY_QIANKUN__</span> ? &#x27;/<span class=\"attr\">sub-micro</span>/<span class=\"attr\">child-react</span>&#x27; <span class=\"attr\">:</span> &#x27;/&#x27;&#125;&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;<span class=\"name\">Switch</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">exact</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;/&quot;</span> <span class=\"attr\">component</span>=<span class=\"string\">&#123;Home&#125;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">            <span class=\"tag\">&lt;<span class=\"name\">Route</span> <span class=\"attr\">exact</span> <span class=\"attr\">path</span>=<span class=\"string\">&quot;/readme&quot;</span> <span class=\"attr\">component</span>=<span class=\"string\">&#123;Readme&#125;</span> /&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">        <span class=\"tag\">&lt;/<span class=\"name\">Switch</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">      <span class=\"tag\">&lt;/<span class=\"name\">HashRouter</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">    <span class=\"tag\">&lt;/<span class=\"name\">React.StrictMode</span>&gt;</span></span>,</span><br><span class=\"line\"> container ? container.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;#root&#x27;</span>) : <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;#root&#x27;</span>)</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(!<span class=\"variable language_\">window</span>.<span class=\"property\">__POWERED_BY_QIANKUN__</span>) &#123;</span><br><span class=\"line\">  <span class=\"title function_\">render</span>(&#123;&#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">bootstrap</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">mount</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">  <span class=\"title function_\">render</span>(props);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">unmount</span>(<span class=\"params\">props</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> &#123; container &#125; = props;</span><br><span class=\"line\">  <span class=\"title class_\">ReactDOM</span>.<span class=\"title function_\">unmountComponentAtNode</span>(container ? container.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;#root&#x27;</span>) : <span class=\"variable language_\">document</span>.<span class=\"title function_\">querySelector</span>(<span class=\"string\">&#x27;#root&#x27;</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"运行和部署\"><a href=\"#运行和部署\" class=\"headerlink\" title=\"运行和部署\"></a>运行和部署</h2><p>在完成以上步骤后，可以启动各个子应用和主应用，确保它们都能独立运行，并通过 qiankun 框架将它们集成在一起。</p>\n<p>子应用的运行地址分别是：</p>\n<ul>\n<li>Angular 子应用：<a href=\"http://localhost:3000/\">http://localhost:3000</a></li>\n<li>Vue 子应用：<a href=\"http://localhost:8000/\">http://localhost:8000</a></li>\n<li>React 子应用：<a href=\"http://localhost:4300/\">http://localhost:4300</a></li>\n</ul>\n<h2 id=\"Demo-代码\"><a href=\"#Demo-代码\" class=\"headerlink\" title=\"Demo 代码\"></a>Demo 代码</h2><p>为了帮助您更好地理解整个过程，我已经将所有代码整合并发布到了 GitHub。您可以访问 <a href=\"https://github.com/chopstickqy/qiankun-demo\">qiankun-demo</a> 查看完整的代码实现，并根据自己的需求进行修改。</p>\n","text":"前言随着前端应用的复杂度不断提升，传统的单体应用架构逐渐暴露出维护困难、技术栈升级困难等问题。为了解决这些挑战，微前端架构应运而生。qiankun 作为一款基于...","permalink":"/post/2021-07-26","photos":[],"count_time":{"symbolsCount":"7.8k","symbolsTime":"7 mins."},"categories":[{"name":"技术","slug":"技术","count":3,"path":"api/categories/技术.json"}],"tags":[{"name":"qiankun","slug":"qiankun","count":1,"path":"api/tags/qiankun.json"},{"name":"微前端","slug":"微前端","count":1,"path":"api/tags/微前端.json"},{"name":"前端架构","slug":"前端架构","count":1,"path":"api/tags/前端架构.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%89%8D%E8%A8%80\"><span class=\"toc-text\">前言</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%BB%80%E4%B9%88%E6%98%AF%E5%BE%AE%E5%89%8D%E7%AB%AF%EF%BC%9F\"><span class=\"toc-text\">什么是微前端？</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Qiankun-%E7%9A%84%E4%BC%98%E5%8A%BF\"><span class=\"toc-text\">Qiankun 的优势</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Qiankun-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86\"><span class=\"toc-text\">Qiankun 的工作原理</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%9E%E8%B7%B5%E6%A1%88%E4%BE%8B\"><span class=\"toc-text\">实践案例</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9E%B6%E6%9E%84%E7%A4%BA%E6%84%8F%E5%9B%BE\"><span class=\"toc-text\">架构示意图</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4\"><span class=\"toc-text\">实现步骤</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#1-%E5%88%9B%E5%BB%BA%E4%B8%BB%E5%BA%94%E7%94%A8-Angular\"><span class=\"toc-text\">1. 创建主应用 (Angular)</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#2-%E5%88%9B%E5%BB%BA%E5%AD%90%E5%BA%94%E7%94%A8-Angular\"><span class=\"toc-text\">2. 创建子应用 (Angular)</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#3-%E5%88%9B%E5%BB%BA%E5%AD%90%E5%BA%94%E7%94%A8-Vue\"><span class=\"toc-text\">3. 创建子应用 (Vue)</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#4-%E5%88%9B%E5%BB%BA%E5%AD%90%E5%BA%94%E7%94%A8-React\"><span class=\"toc-text\">4. 创建子应用 (React)</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%BF%90%E8%A1%8C%E5%92%8C%E9%83%A8%E7%BD%B2\"><span class=\"toc-text\">运行和部署</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Demo-%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">Demo 代码</span></a></li></ol>","author":{"name":"Charles","slug":"blog-author","avatar":"https://chopstickqy.github.io/images/logo.png","link":"/","description":"Think like an artist, develop like an artisan.","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"解决 node-canvas 安装问题：Mac M1、Python 版本、musl 兼容性","uid":"d81abd1fab3fac8213cc029b31d1d3c6","slug":"2024-11-26","date":"2024-11-25T16:00:00.000Z","updated":"2025-02-15T17:52:03.176Z","comments":true,"path":"api/articles/2024-11-26.json","keywords":null,"cover":null,"text":"背景在项目中需要生成二维码，因此选择了 easyqrcodejs 作为前端和后端（Node.js）二维码生成方案。然而，在服务端使用 easyqrcodejs ...","permalink":"/post/2024-11-26","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":"技术","slug":"技术","count":3,"path":"api/categories/技术.json"}],"tags":[{"name":"node-canvas","slug":"node-canvas","count":1,"path":"api/tags/node-canvas.json"},{"name":"EasyQRCodeJS","slug":"EasyQRCodeJS","count":1,"path":"api/tags/EasyQRCodeJS.json"},{"name":"Node.js","slug":"Node-js","count":1,"path":"api/tags/Node-js.json"},{"name":"M1","slug":"M1","count":1,"path":"api/tags/M1.json"},{"name":"Docker","slug":"Docker","count":1,"path":"api/tags/Docker.json"}],"author":{"name":"Charles","slug":"blog-author","avatar":"https://chopstickqy.github.io/images/logo.png","link":"/","description":"Think like an artist, develop like an artisan.","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"解决IE8连接TLS 1.0服务端的问题","uid":"8106ab3111152a5d4804fa67308308c0","slug":"2020-03-27","date":"2020-03-26T16:00:00.000Z","updated":"2025-02-15T17:52:03.175Z","comments":true,"path":"api/articles/2020-03-27.json","keywords":null,"cover":null,"text":"问题描述在某些情况下，IE8客户端无法连接到支持TLS 1.0协议的服务端。这表明客户端请求的Cipher Suite在服务端不被支持。问题原因是服务端的JDK...","permalink":"/post/2020-03-27","photos":[],"count_time":{"symbolsCount":"2k","symbolsTime":"2 mins."},"categories":[{"name":"技术","slug":"技术","count":3,"path":"api/categories/技术.json"}],"tags":[{"name":"TLS","slug":"TLS","count":1,"path":"api/tags/TLS.json"},{"name":"Cipher Suite","slug":"Cipher-Suite","count":1,"path":"api/tags/Cipher-Suite.json"},{"name":"JDK","slug":"JDK","count":1,"path":"api/tags/JDK.json"},{"name":"JRE","slug":"JRE","count":1,"path":"api/tags/JRE.json"}],"author":{"name":"Charles","slug":"blog-author","avatar":"https://chopstickqy.github.io/images/logo.png","link":"/","description":"Think like an artist, develop like an artisan.","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}